diff --git a/src/openbsd-compat/bcrypt_pbkdf.c b/src/openbsd-compat/bcrypt_pbkdf.c
index 0a07f9a..d841940 100644
--- a/src/openbsd-compat/bcrypt_pbkdf.c
+++ b/src/openbsd-compat/bcrypt_pbkdf.c
@@ -20,7 +20,9 @@
 #ifndef HAVE_BCRYPT_PBKDF

 #include <sys/types.h>
+#ifndef _WIN32
 #include <sys/param.h>
+#endif

 #ifdef HAVE_STDLIB_H
 # include <stdlib.h>
@@ -93,7 +95,7 @@ bcrypt_hash(uint8_t *sha2pass, uint8_t *sha2salt, uint8_t *out)
 		cdata[i] = Blowfish_stream2word(ciphertext, sizeof(ciphertext),
 		    &j);
 	for (i = 0; i < 64; i++)
-		blf_enc(&state, cdata, sizeof(cdata) / sizeof(uint64_t));
+		blf_enc(&state, cdata, (sizeof(cdata) / sizeof(uint64_t)));

 	/* copy out */
 	for (i = 0; i < BCRYPT_WORDS; i++) {
diff --git a/src/openbsd-compat/blowfish.c b/src/openbsd-compat/blowfish.c
index e10f7e7..c088a7a 100644
--- a/src/openbsd-compat/blowfish.c
+++ b/src/openbsd-compat/blowfish.c
@@ -62,6 +62,14 @@
 #endif				/* !__GNUC__ */

 /* Function for Feistel Networks */
+/* Note: Blowfish intentionally uses wrapping arithmetic (modulo 2^32).
+ * Unsigned integer overflow is well-defined in C and is the correct behavior.
+ * Disable UBSan warnings for this intentional arithmetic. */
+#if defined(__clang__)
+#define BLOWFISH_FUNC __attribute__((no_sanitize("unsigned-integer-overflow")))
+#else
+#define BLOWFISH_FUNC
+#endif

 #define F(s, x) ((((s)[        (((x)>>24)&0xFF)]  \
 		 + (s)[0x100 + (((x)>>16)&0xFF)]) \
@@ -70,6 +78,7 @@

 #define BLFRND(s,p,i,j,n) (i ^= F(s,j) ^ (p)[n])

+BLOWFISH_FUNC
 void
 Blowfish_encipher(blf_ctx *c, u_int32_t *xl, u_int32_t *xr)
 {
@@ -95,6 +104,7 @@ Blowfish_encipher(blf_ctx *c, u_int32_t *xl, u_int32_t *xr)
 	*xr = Xl;
 }

+BLOWFISH_FUNC
 void
 Blowfish_decipher(blf_ctx *c, u_int32_t *xl, u_int32_t *xr)
 {
