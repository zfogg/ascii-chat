#!/bin/sh
# ascii-chat uninstall script
# Generated by CPack for version @PROJECT_VERSION@

# Auto-detect installation prefix from script location
# This script is installed to ${PREFIX}/bin/ascii-chat-uninstall.sh
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PREFIX="$(dirname "${SCRIPT_DIR}")"

echo "==============================================="
echo "ascii-chat @PROJECT_VERSION@ Uninstaller"
echo "==============================================="
echo ""
echo "This will remove ascii-chat from: ${PREFIX}"
echo ""
echo "Files to be removed:"
echo "  - Binary: ${PREFIX}/bin/ascii-chat"
echo "  - Library: ${PREFIX}/lib/libasciichat.so"
echo "  - Headers: ${PREFIX}/include/ascii-chat/"
echo "  - Manpages: ${PREFIX}/share/man/man3/ascii-chat-*.3"
echo "  - Documentation: ${PREFIX}/share/doc/ascii-chat/"
echo "  - Pkg-config: ${PREFIX}/lib/pkgconfig/ascii-chat.pc"
echo "  - CMake config: ${PREFIX}/lib/cmake/ascii-chat/"
echo ""
printf "Do you want to continue? [y/N]: "
read answer

case "${answer}" in
    y|Y|yes|YES)
        echo ""
        echo "Uninstalling ascii-chat..."

        # Remove binary
        if [ -f "${PREFIX}/bin/ascii-chat" ]; then
            echo "  Removing binary..."
            rm -f "${PREFIX}/bin/ascii-chat"
        fi

        # Remove shared library
        if [ -f "${PREFIX}/lib/libasciichat.so" ]; then
            echo "  Removing shared library..."
            rm -f "${PREFIX}/lib/libasciichat.so"
        fi

        # Remove headers
        if [ -d "${PREFIX}/include/ascii-chat" ]; then
            echo "  Removing headers..."
            rm -rf "${PREFIX}/include/ascii-chat"
        fi

        # Remove manpages
        if [ -d "${PREFIX}/share/man/man3" ]; then
            echo "  Removing manpages..."
            rm -f "${PREFIX}/share/man/man3/ascii-chat-"*.3
            # Remove man3 directory if empty
            rmdir "${PREFIX}/share/man/man3" 2>/dev/null || true
            rmdir "${PREFIX}/share/man" 2>/dev/null || true
        fi

        # Remove documentation
        if [ -d "${PREFIX}/share/doc/ascii-chat" ]; then
            echo "  Removing documentation..."
            rm -rf "${PREFIX}/share/doc/ascii-chat"
            # Remove doc directory if empty
            rmdir "${PREFIX}/share/doc" 2>/dev/null || true
        fi

        # Remove pkg-config file
        if [ -f "${PREFIX}/lib/pkgconfig/ascii-chat.pc" ]; then
            echo "  Removing pkg-config file..."
            rm -f "${PREFIX}/lib/pkgconfig/ascii-chat.pc"
            rmdir "${PREFIX}/lib/pkgconfig" 2>/dev/null || true
        fi

        # Remove CMake config
        if [ -d "${PREFIX}/lib/cmake/ascii-chat" ]; then
            echo "  Removing CMake config..."
            rm -rf "${PREFIX}/lib/cmake/ascii-chat"
            rmdir "${PREFIX}/lib/cmake" 2>/dev/null || true
        fi

        # Remove share directory if empty
        rmdir "${PREFIX}/share" 2>/dev/null || true

        # Remove this uninstall script
        if [ -f "${PREFIX}/bin/ascii-chat-uninstall.sh" ]; then
            rm -f "${PREFIX}/bin/ascii-chat-uninstall.sh"
        fi

        echo ""
        echo "âœ“ Uninstallation complete!"
        echo ""
        ;;
    *)
        echo "Uninstallation cancelled."
        exit 1
        ;;
esac

exit 0
